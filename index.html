<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>머니블랙박스 (MONEY BLACKBOX)</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="https://hangeul.pstatic.net/hangeul_static/css/nanum-barun-gothic.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#0066FF' },
                    fontFamily: { sans: ['Pretendard', 'Nanum Barun Gothic', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Pretendard', 'Nanum Barun Gothic', sans-serif; background-color: #f3f4f6; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .clip-left { clip-path: polygon(100% 0, 0 100%, 100% 100%); }
        .clip-right { clip-path: polygon(0 0, 0 100%, 100% 100%); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 1. 안전한 변수 가져오기
        const { useState, useEffect, useRef } = React;
        const MotionLib = window.Motion || window.FramerMotion;
        const { motion, AnimatePresence, useInView } = MotionLib || { motion: { div: 'div' }, AnimatePresence: ({children})=>children, useInView: ()=>true };
        const SupabaseLib = window.supabase || window.Supabase;
        
        // 2. 앱 설정 (사용자님의 진짜 키를 제가 넣어뒀습니다)
        const supabaseUrl = 'https://iiuxqifppjuwracdewrn.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlpdXhxaWZwcGp1d3JhY2Rld3JuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1Njk0MTQsImV4cCI6MjA4MjE0NTQxNH0.d53vLqEcBhgsSU19EhkM8D1cs2_ne6UpYQ-xbnU4Zvw';
        const supabaseClient = SupabaseLib ? SupabaseLib.createClient(supabaseUrl, supabaseAnonKey) : null;

        const App = () => {
            const [regCount, setRegCount] = useState(0);
            const [displayCount, setDisplayCount] = useState(0);
            const [phoneNumber, setPhoneNumber] = useState('');
            const [email, setEmail] = useState('');
            const [requiredAgreed, setRequiredAgreed] = useState(false);
            const [marketingAgreed, setMarketingAgreed] = useState(false);
            const [activeModal, setActiveModal] = useState(null);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const countRef = useRef(null);
            const isCountInView = useInView(countRef, { once: true, margin: "-20% 0px" });

            useEffect(() => {
                const targetCount = Math.floor(Math.random() * (250 - 50 + 1)) + 50;
                setRegCount(targetCount);
                setDisplayCount(targetCount - 50 > 0 ? targetCount - 50 : 0);
            }, []);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            });

            useEffect(() => {
                if (isCountInView && regCount > 0) {
                    const duration = 1000;
                    const startCount = regCount - 50 > 0 ? regCount - 50 : 0;
                    const startTime = performance.now();
                    const animate = (currentTime) => {
                        const elapsedTime = currentTime - startTime;
                        const progress = Math.min(elapsedTime / duration, 1);
                        const easeOutQuad = (t) => t * (2 - t);
                        const currentNumber = Math.floor(startCount + (regCount - startCount) * easeOutQuad(progress));
                        setDisplayCount(currentNumber);
                        if (progress < 1) requestAnimationFrame(animate);
                        else setDisplayCount(regCount);
                    };
                    requestAnimationFrame(animate);
                }
            }, [isCountInView, regCount]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!requiredAgreed || !marketingAgreed) {
                    alert('필수 동의 항목에 모두 동의해주세요.');
                    return;
                }
                if (!supabaseClient) {
                    alert('데이터베이스 연결 라이브러리 로딩 실패');
                    return;
                }
                setIsSubmitting(true);
                try {
                    // 데이터 전송 시도
                    const { error } = await supabaseClient
                        .from('pre_registrations')
                        .insert([{ 
                            phone_number: phoneNumber, 
                            email: email, 
                            agreed_to_terms: requiredAgreed,
                            marketing_agreed: marketingAgreed
                        }]);
                    
                    if (error) {
                        // 🚨 여기가 핵심: 에러 내용을 정확히 보여줍니다 🚨
                        throw error;
                    }

                    alert('🎉 사전등록이 완료되었습니다!');
                    setPhoneNumber(''); setEmail(''); setRequiredAgreed(false); setMarketingAgreed(false);
                } catch (error) {
                    console.error('Error Details:', error);
                    // 에러 메시지를 팝업으로 띄웁니다.
                    alert('⚠️ 오류 발생: ' + (error.message || error.error_description || JSON.stringify(error)));
                } finally {
                    setIsSubmitting(false);
                }
            };

            const Modal = ({ type, onClose }) => {
                const content = type === 'privacy' ? {
                    title: '개인정보 처리방침',
                    text: `1. 개인정보 수집 및 이용 목적\n- 서비스 출시 알림 제공\n- 잠재 고객 수요 조사 및 분석\n- 서비스 초기 프로모션 혜택 제공\n\n2. 수집하는 개인정보 항목\n- 필수항목: 휴대전화번호, 이메일 주소\n\n3. 개인정보 보유 및 이용 기간\n- 이용 기간: 사전 신청 시점부터 서비스 정식 출시 후 3개월까지\n- 파기 시점: 보유 기간 경과 또는 이용 목적 달성 시 지체 없이 파기\n(단, 관계 법령에 따라 보존할 필요가 있는 경우 해당 기간 동안 보관)\n\n4. 동의 거부 권리 및 불이익\n- 귀하는 개인정보 수집 및 이용에 대한 동의를 거부할 권리가 있습니다.\n- 단, 동의를 거부할 경우 사전 신청 등록 및 출시 알림 서비스 이용이 제한될 수 있습니다.`
                } : {
                    title: '마케팅 정보 수신 동의',
                    text: `1. 개인정보 수집 및 이용 목적\n- 서비스 정식 런칭 소식 안내 (SMS/이메일)\n- 새로운 기능, 이벤트, 프로모션 혜택 등 광고성 정보 전송\n\n2. 수집 및 이용하는 개인정보 항목\n- 휴대전화번호, 이메일 주소\n\n3. 보유 및 이용 기간\n- 이용 기간: 수집일로부터 1년 또는 동의 철회 시까지\n- 고객이 동의를 철회하는 경우 지체 없이 파기합니다.\n\n4. 동의 거부 권리 및 유의사항\n- 귀하는 마케팅 정보 수신에 대한 동의를 거부할 수 있습니다.\n- 동의를 거부하더라도 사전 신청 자체는 가능하나, 출시 알림이나 혜택 정보를 받지 못할 수 있습니다.`
                };

                return (
                    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/40 backdrop-blur-sm" onClick={onClose}>
                        <motion.div initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="bg-white w-full max-w-sm rounded-3xl overflow-hidden shadow-2xl flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                            <div className="p-6 border-b flex justify-between items-center">
                                <h4 className="font-bold">{content.title}</h4>
                                <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors"><i data-lucide="x" className="w-5 h-5 text-gray-400"></i></button>
                            </div>
                            <div className="p-6 overflow-y-auto whitespace-pre-wrap text-sm text-gray-600 leading-relaxed">{content.text}</div>
                            <div className="p-4 bg-gray-50"><button onClick={onClose} className="w-full py-3 bg-gray-900 text-white font-bold rounded-xl">닫기</button></div>
                        </motion.div>
                    </motion.div>
                );
            };

            return (
                <div className="flex justify-center min-h-screen">
                    <main className="w-full max-w-md bg-white shadow-xl min-h-screen overflow-x-hidden relative">
                        <AnimatePresence>{activeModal && <Modal type={activeModal} onClose={() => setActiveModal(null)} />}</AnimatePresence>

                        {/* Phase 1: Hero */}
                        <section className="flex flex-col items-center bg-white overflow-hidden pb-60">
                            <div className="w-full text-center pt-12 pb-20"><h2 className="text-lg font-black tracking-tighter">MONEY<br/>BLACKBOX</h2></div>
                            <div className="w-full px-12 mb-36 flex flex-col items-start">
                                <p className="text-black font-medium mb-2 text-xl">쉽고 간편하게</p>
                                <div className="text-4xl font-extrabold leading-[1.3] tracking-tight">
                                    <p>의심은 덜고</p>
                                    <p><span className="text-primary">신뢰</span>는 더하는 법</p>
                                </div>
                            </div>
                            <div className="relative w-full px-4 flex items-center justify-center">
                                <div className="relative z-10 w-full max-w-[320px]">
                                    <img src="hero.png" alt="Hero" className="w-full h-auto object-contain" />
                                </div>
                            </div>
                        </section>

                        {/* Phase 2: Transition */}
                        <section className="bg-white flex items-center justify-center">
                            <div className="bg-black w-full aspect-square flex items-center justify-center shadow-2xl">
                                <h2 className="text-white text-5xl font-black tracking-tighter text-center leading-[1.4]">MONEY<br/>BLACKBOX</h2>
                            </div>
                        </section>

                        {/* Phase 3: Bubbles */}
                        <section className="bg-white pt-40 pb-40 px-6 space-y-12">
                            {[
                                { text: '"불안해서 먼저 입금을 못 하겠어요"', tail: 'left' },
                                { text: '"상대방이 돈을 안 주면 어떡하죠?"', tail: 'right' },
                                { text: '"혹시 사기는 아닐까?"', tail: 'both' }
                            ].map((b, i) => (
                                <motion.div key={i} initial={{ opacity: 0, x: i % 2 === 0 ? -30 : 30 }} whileInView={{ opacity: 1, x: 0 }} transition={{ duration: 1.2, delay: i * 0.3 }} viewport={{ once: true }} className="flex justify-center">
                                    <div className="relative bg-[#E0E0E0] px-8 py-4 rounded-[2rem] w-full max-w-[320px] text-center shadow-sm">
                                        <p className="text-[15px] font-medium leading-relaxed">{b.text}</p>
                                        {(b.tail === 'left' || b.tail === 'both') && <div className="absolute left-[-8px] bottom-4 w-6 h-6 bg-[#E0E0E0] clip-left"></div>}
                                        {(b.tail === 'right' || b.tail === 'both') && <div className="absolute right-[-8px] bottom-4 w-6 h-6 bg-[#E0E0E0] clip-right"></div>}
                                    </div>
                                </motion.div>
                            ))}
                            <div className="pt-40 space-y-12">
                                <motion.div initial={{ opacity: 0, x: -50 }} whileInView={{ opacity: 1, x: 0 }} transition={{ duration: 1.5 }} viewport={{ once: true }} className="text-left px-4 font-bold text-xl leading-relaxed">작은 의심 때문에<br/>우리는 너무 많은 기회를<br/>포기해왔습니다</motion.div>
                                <motion.div initial={{ opacity: 0, x: 50 }} whileInView={{ opacity: 1, x: 0 }} transition={{ duration: 1.5, delay: 0.4 }} viewport={{ once: true }} className="text-right px-4 font-bold text-xl leading-relaxed text-black">우리는 의심이<br/>좋은 기회를 가로막는 장벽이<br/>되지 않기를 바랍니다</motion.div>
                            </div>
                        </section>

                        {/* Phase 4: Catch Phrase */}
                        <section className="bg-black py-28 px-8">
                            <h2 className="text-white text-2xl font-bold leading-[1.6]">MONEY BLACKBOX<br/>에서 의심을 지우고<br/><span className="text-primary">신뢰</span>로 기회를 잡으세요</h2>
                        </section>

                        {/* Phase 5: Process */}
                        <section className="bg-white py-20 px-8 relative">
                            <h3 className="text-lg font-bold mb-16 text-black">MONEY BLACKBOX 안에서는<br/>이런 방식으로 거래가 이루어져요</h3>
                            <div className="space-y-32">
                                {[
                                    { n: 1, t: '구매자는\n정해진 가상계좌에\n거래 금액을 입금해요', align: 'right' },
                                    { n: 2, t: '판매자는\n입금여부를 확인하고\n거래를 진행해요', align: 'left' },
                                    { n: 3, t: '거래가 완료되고\n구매자와 판매자는\n거래 성사 여부에\n동의해요', align: 'right' }
                                ].map((s, i) => (
                                    <motion.div key={i} initial={{ opacity: 0, x: 50 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true, margin: "-20% 0px" }} className={`relative flex justify-${s.align === 'right' ? 'end' : 'start'} items-center`}>
                                        <span className={`absolute ${s.align === 'right' ? 'left-0' : 'right-0'} text-8xl font-black text-[#0066FF] opacity-50 select-none`}>{s.n}</span>
                                        <div className={`text-${s.align} z-10 whitespace-pre-wrap text-sm font-medium text-gray-800`}>{s.t}</div>
                                    </motion.div>
                                ))}
                                <motion.div initial={{ opacity: 0, x: 50 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true, margin: "-20% 0px" }} className="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                                    <p className="text-sm text-black leading-relaxed">거래 과정에서 문제가 발생하면 합의가 이루어질 때까지<br/>여분의 소중한 재산은 머니블랙박스가 안전하게 보호합니다</p>
                                </motion.div>
                                <motion.div initial={{ opacity: 0, x: 50 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true, margin: "-20% 0px" }} className="relative flex justify-start items-center">
                                    <span className="absolute right-0 text-8xl font-black text-[#0066FF] opacity-50 select-none">4</span>
                                    <div className="text-left z-10 text-sm font-medium text-gray-800 leading-relaxed">머니블랙박스가 꼼꼼하게<br/>거래성사 여부를 확인하고<br/>정산이 이루어져요</div>
                                </motion.div>
                            </div>
                        </section>

                        {/* Phase 6: Features */}
                        <section className="bg-white pt-40 pb-20 px-8">
                            <h3 className="text-2xl font-bold mb-12 text-black">머니블랙박스는</h3>
                            <div className="space-y-12">
                                {[
                                    { h: '1. 모든 거래에 적용이 가능합니다', p: '중고거래부터 - 공사비용까지' },
                                    { h: '2. 안전한 거래를 최우선으로 지향합니다', p: '수상한 거래 감지시, 먼저 거래 중단, 차단!\n소중한 재산을 안전하게 보관' },
                                    { h: '3. 제약이 없습니다', p: '인스타, 카페, 블로그 어디에서 본 상품을\n결제는 수수료 ZERO 머니 블랙박스 결제 링크로!' }
                                ].map((f, i) => (
                                    <div key={i}><h4 className="text-lg font-bold text-primary mb-3">{f.h}</h4><p className="text-base text-black whitespace-pre-wrap leading-relaxed">{f.p}</p></div>
                                ))}
                            </div>
                        </section>

                        {/* Phase 7: Emphasis */}
                        <section className="bg-white pt-40 pb-40 text-center px-8">
                            <h3 className="text-2xl font-bold leading-[1.6] text-black">머니블랙박스를 통해<br/>거래의 <span className="text-primary">신뢰</span>를 확보하세요</h3>
                        </section>

                        {/* Phase 8: Form */}
                        <section className="bg-white py-20 px-8 border-t border-gray-100">
                            <div className="text-center mb-10"><p className="text-sm font-bold text-gray-600 mb-2">지금 사전등록하면 (선착순 300명)</p><h2 className="text-2xl font-bold">평생 안심결제 수수료 <span className="text-primary text-3xl">0원</span></h2></div>
                            <div className="mb-12" ref={countRef}><p className="text-xs font-bold text-black mb-4 text-center">사전등록 현황</p><div className="flex justify-center items-end gap-2"><span className="text-5xl font-black text-primary">{displayCount}</span><span className="text-2xl font-bold text-gray-400">/ 300</span></div></div>
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div className="space-y-1"><label className="text-xs font-bold text-black">전화번호</label><input type="tel" placeholder="010-0000-0000" className="w-full bg-gray-100 rounded-xl px-4 py-4 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20" value={phoneNumber} onChange={e => setPhoneNumber(e.target.value)} required /></div>
                                <div className="space-y-1"><label className="text-xs font-bold text-black">이메일</label><input type="email" placeholder="example@email.com" className="w-full bg-gray-100 rounded-xl px-4 py-4 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20" value={email} onChange={e => setEmail(e.target.value)} required /></div>
                                <div className="py-4 space-y-4">
                                    <div className="flex items-center justify-between">
                                        <label className="flex items-center gap-2 cursor-pointer"><input type="checkbox" className="hidden" checked={requiredAgreed} onChange={() => setRequiredAgreed(!requiredAgreed)} /><div className={`w-5 h-5 rounded border ${requiredAgreed ? 'bg-primary border-primary' : 'border-gray-300'} flex items-center justify-center transition-colors`}>{requiredAgreed && <i data-lucide="check" className="w-3 h-3 text-white"></i>}</div><span className="text-xs font-medium text-gray-600">[필수] 개인정보 수집 및 이용에 동의합니다.</span></label>
                                        <button type="button" onClick={() => setActiveModal('privacy')} className="text-[10px] text-gray-400 underline">(전문 보기)</button>
                                    </div>
                                    <div className="flex items-center justify-between">
                                        <label className="flex items-center gap-2 cursor-pointer"><input type="checkbox" className="hidden" checked={marketingAgreed} onChange={() => setMarketingAgreed(!marketingAgreed)} /><div className={`w-5 h-5 rounded border ${marketingAgreed ? 'bg-primary border-primary' : 'border-gray-300'} flex items-center justify-center transition-colors`}>{marketingAgreed && <i data-lucide="check" className="w-3 h-3 text-white"></i>}</div><span className="text-xs font-medium text-gray-600">[필수] 서비스 출시 알림 및 이벤트 정보 수신에 동의합니다.</span></label>
                                        <button type="button" onClick={() => setActiveModal('marketing')} className="text-[10px] text-gray-400 underline">(전문 보기)</button>
                                    </div>
                                </div>
                                <button type="submit" disabled={isSubmitting || !requiredAgreed || !marketingAgreed} className={`w-full bg-primary text-white font-bold py-5 rounded-2xl shadow-lg shadow-primary/30 active:scale-[0.98] transition-all ${isSubmitting || !requiredAgreed || !marketingAgreed ? 'opacity-50 cursor-not-allowed grayscale' : ''}`}>{isSubmitting ? '등록 중...' : '사전등록하기'}</button>
                            </form>
                        </section>
                        <footer className="py-10 text-center border-t border-gray-50"><p className="text-[10px] text-gray-300">© 2025 MONEY BLACKBOX. All rights reserved.</p></footer>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
