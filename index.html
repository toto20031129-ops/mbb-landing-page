<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>머니블랙박스 (MONEY BLACKBOX)</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="https://hangeul.pstatic.net/hangeul_static/css/nanum-barun-gothic.css">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#0066FF' },
                    fontFamily: { sans: ['Pretendard', 'Nanum Barun Gothic', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Pretendard', 'Nanum Barun Gothic', sans-serif; background-color: #f3f4f6; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .clip-left { clip-path: polygon(100% 0, 0 100%, 100% 100%); }
        .clip-right { clip-path: polygon(0 0, 0 100%, 100% 100%); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        // [수정 포인트 1] FramerMotion 변수 접근 방식 변경 (안전하게 window 객체 확인)
        const { motion, AnimatePresence, useInView } = window.Motion; 

        // Supabase Initialization
        const supabaseUrl = 'https://iiuxqifppjuwracdewrn.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlpdXhxaWZwcGp1d3JhY2Rld3JuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1Njk0MTQsImV4cCI6MjA4MjE0NTQxNH0.d53vLqEcBhgsSU19EhkM8D1cs2_ne6UpYQ-xbnU4Zvw';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);

        const App = () => {
            const [regCount, setRegCount] = useState(0);
            const [displayCount, setDisplayCount] = useState(0);
            const [phoneNumber, setPhoneNumber] = useState('');
            const [email, setEmail] = useState('');
            const [requiredAgreed, setRequiredAgreed] = useState(false);
            const [marketingAgreed, setMarketingAgreed] = useState(false);
            const [activeModal, setActiveModal] = useState(null);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const countRef = useRef(null);
            const isCountInView = useInView(countRef, { once: true, margin: "-20% 0px" });

            useEffect(() => {
                const targetCount = Math.floor(Math.random() * (250 - 50 + 1)) + 50;
                setRegCount(targetCount);
                setDisplayCount(targetCount - 50 > 0 ? targetCount - 50 : 0);
            }, []);

            useEffect(() => {
                // Lucide 아이콘 렌더링 (DOM 업데이트 후 실행)
                lucide.createIcons();
            });

            useEffect(() => {
                if (isCountInView && regCount > 0) {
                    const duration = 1000;
                    const startCount = regCount - 50 > 0 ? regCount - 50 : 0;
                    const startTime = performance.now();
                    const animate = (currentTime) => {
                        const elapsedTime = currentTime - startTime;
                        const progress = Math.min(elapsedTime / duration, 1);
                        const easeOutQuad = (t) => t * (2 - t);
                        const currentNumber = Math.floor(startCount + (regCount - startCount) * easeOutQuad(progress));
                        setDisplayCount(currentNumber);
                        if (progress < 1) requestAnimationFrame(animate);
                        else setDisplayCount(regCount);
                    };
                    requestAnimationFrame(animate);
                }
            }, [isCountInView, regCount]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!requiredAgreed || !marketingAgreed) {
                    alert('필수 동의 항목에 모두 동의해주세요.');
                    return;
                }
                setIsSubmitting(true);
                try {
                    const { error } = await supabaseClient
                        .from('pre_registrations')
                        .insert([{ 
                            phone_number: phoneNumber, 
                            email: email, 
                            agreed_to_terms: requiredAg
